[phases.setup]
aptPkgs = ["chromium", "libnss3", "libfreetype6", "libharfbuzz0b", "ca-certificates", "fonts-freefont-ttf"]

[phases.install]
cmds = ["npm install -g pnpm", "NODE_ENV=development pnpm install --frozen-lockfile"]

[phases.build]
cmds = [
  "npx prisma generate",
  "npx tsc -p tsconfig.build.json",
  "test -f dist/main.js && echo 'BUILD OK: dist/main.js exists' || (echo 'BUILD FAILED: dist/main.js not found' && exit 1)"
]

[variables]
PUPPETEER_SKIP_CHROMIUM_DOWNLOAD = "true"
PUPPETEER_EXECUTABLE_PATH = "/usr/bin/chromium"

[start]
cmd = "npx prisma migrate deploy && node dist/main.js"
